<!DOCTYPE html>
<html>
<head>
    <title>Nexus Hub OS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        /* --- 1. GLOBAL AESTHETICS --- */
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');

        body {
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
            font-family: 'Rajdhani', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- 2. LOGIN SCREEN --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 12, 41, 0.95);
            z-index: 999;
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .login-card { 
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(88, 101, 242, 0.3); 
            padding: 60px; width: 350px; border-radius: 20px; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transform: scale(1); transition: transform 0.3s;
        }

        .system-unlocked #login-screen { opacity: 0; pointer-events: none; transform: scale(1.1); }

        h2 { margin: 0 0 20px 0; font-size: 36px; text-transform: uppercase; letter-spacing: 4px; color: #fff; text-shadow: 0 0 15px #5865F2; }
        
        input { 
            background: rgba(0, 0, 0, 0.4); border: 2px solid #333; color: #fff; 
            padding: 15px; width: 85%; border-radius: 8px; font-family: 'Rajdhani', sans-serif; 
            font-size: 24px; text-align: center; letter-spacing: 5px; outline: none; transition: 0.3s; margin-bottom: 25px; 
        }
        input:focus { border-color: #5865F2; box-shadow: 0 0 20px rgba(88, 101, 242, 0.3); }
        
        .btn { 
            background: linear-gradient(90deg, #5865F2, #4752c4); color: white; padding: 15px 30px; 
            border: none; border-radius: 8px; font-size: 20px; font-weight: bold; text-transform: uppercase; 
            letter-spacing: 3px; cursor: pointer; transition: 0.2s; width: 100%; 
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(88, 101, 242, 0.5); }

        /* --- 3. MAIN INTERFACE --- */
        #main-interface {
            width: 95vw; height: 90vh;
            background: rgba(20, 20, 35, 0.8);
            border: 2px solid rgba(88, 101, 242, 0.5);
            box-shadow: 0 0 20px rgba(88, 101, 242, 0.2);
            border-radius: 15px;
            display: flex; flex-direction: column; overflow: hidden;
            
            /* BOOT ANIMATION START STATE */
            opacity: 0; transform: scale(0.9); filter: blur(10px);
            transition: opacity 0.8s ease-out, transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 0.8s ease;
        }

        .system-unlocked #main-interface { opacity: 1; transform: scale(1); filter: blur(0px); }

        /* --- BASS REACTION --- */
        .bass-active {
            border-color: #ff0055 !important;
            box-shadow: 0 0 60px rgba(255, 0, 85, 0.9), inset 0 0 40px rgba(255,0,85, 0.4) !important;
            transform: scale(1.01) !important; 
            transition: transform 0.05s, box-shadow 0.05s; /* Snappy response */
        }

        /* --- TABS & CONTENT --- */
        .tabs-header { display: flex; background: rgba(0,0,0,0.5); border-bottom: 1px solid rgba(255,255,255,0.1); height: 60px; flex-shrink: 0; }
        .tab-btn { flex: 1; background: transparent; border: none; color: #666; font-family: 'Rajdhani', sans-serif; font-size: 20px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: 0.3s; position: relative; }
        .tab-btn:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .tab-btn.active { color: #fff; text-shadow: 0 0 15px currentColor; background: rgba(255,255,255,0.02); }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: #5865F2; box-shadow: 0 -2px 10px #5865F2; }
        
        .content-area { flex: 1; position: relative; overflow: hidden; width: 100%; height: 100%; }
        .view-section { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; pointer-events: none; transition: 0.5s ease; transform: translateY(20px); }
        .view-section.active { opacity: 1; pointer-events: auto; transform: translateY(0); }

        #view-comms { display: flex; width: 100%; height: 100%; }
        #view-comms iframe { width: 100%; height: 100%; border: none; display: block; }

        .media-center { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; background: radial-gradient(circle at center, rgba(255,0,85,0.1), transparent 70%); }
        .monitor-frame { width: 70%; max-width: 800px; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 15px; overflow: hidden; box-shadow: 0 0 30px rgba(0,0,0,0.5); background: black; position: relative; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        #local-audio { display: none; }
        #file-upload { display: none; }

        .media-controls { margin-top: 30px; display: flex; gap: 20px; background: rgba(0,0,0,0.4); padding: 20px 40px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1); }
        .control-btn { background: transparent; border: 2px solid rgba(255,255,255,0.2); color: white; width: 60px; height: 60px; border-radius: 50%; font-size: 24px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .control-btn:hover { border-color: #ff0055; color: #ff0055; box-shadow: 0 0 20px rgba(255, 0, 85, 0.4); transform: scale(1.1); }
        .upload-btn { border-color: #5865F2; }
        .upload-btn:hover { border-color: #fff; color: #fff; box-shadow: 0 0 20px #5865F2; }
        .track-info { margin-top: 20px; font-size: 24px; letter-spacing: 2px; text-shadow: 0 0 10px rgba(255,255,255,0.5); }

    </style>
</head>
<body id="body-container">

    <audio id="local-audio" controls></audio>

    <div id="login-screen">
        <div class="login-card">
            <h2>NEXUS OS</h2>
            <input type="password" id="passInput" placeholder="ACCESS CODE">
            <button class="btn" onclick="bootSystem()">BOOT SYSTEM</button>
        </div>
    </div>

    <div id="main-interface">
        
        <div class="tabs-header">
            <button id="tab-btn-comms" class="tab-btn active" onclick="switchTab('comms')">// COMMS</button>
            <button id="tab-btn-media" class="tab-btn" onclick="switchTab('media')">// MEDIA</button>
        </div>

        <div class="content-area">
            <div id="view-comms" class="view-section active">
                <iframe src="https://e.widgetbot.io/channels/1415812467719802995/1415812468755660864" allow="clipboard-write; fullscreen"></iframe>
            </div>
            <div id="view-media" class="view-section">
                <div class="media-center">
                    <div class="monitor-frame">
                        <div class="video-container">
                            <div id="player"></div>
                        </div>
                    </div>
                    <div class="track-info" id="track-title">System Standby</div>
                    
                    <div class="media-controls">
                        <input type="file" id="file-upload" accept="audio/*">
                        <button class="control-btn upload-btn" title="Upload Local File" onclick="document.getElementById('file-upload').click()">&#8679;</button>
                        <button class="control-btn" onclick="prevTrack()">&#9664;</button>
                        <button class="control-btn" onclick="togglePlay()">&#9654;&#10074;&#10074;</button>
                        <button class="control-btn" onclick="nextTrack()">&#9654;&#9654;</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        var isLocalFile = false;
        var audioCtx, analyser, source;
        var audioEl = document.getElementById("local-audio");
        var bassInterval; 

        // --- 1. BOOT SEQUENCE ---
        function bootSystem() {
            var pass = document.getElementById("passInput").value;
            if(pass === "12345") {
                document.body.classList.add("system-unlocked");
                
                // Audio Ignition
                if(player && player.playVideo) {
                    player.unMute(); player.setVolume(100); player.playVideo();
                }
                // Prepare Audio Context
                initAudioContext();
            } else {
                // Denied Animation
                var card = document.querySelector(".login-card");
                card.style.transform = "translateX(10px)";
                setTimeout(() => card.style.transform = "translateX(-10px)", 100);
                setTimeout(() => card.style.transform = "translateX(10px)", 200);
                setTimeout(() => card.style.transform = "scale(1)", 300);
                
                var btn = document.querySelector(".btn");
                btn.innerText = "ACCESS DENIED";
                btn.style.background = "#ed4245";
                setTimeout(() => { btn.innerText = "BOOT SYSTEM"; btn.style.background = "linear-gradient(90deg, #5865F2, #4752c4)"; }, 1000);
            }
        }
        document.getElementById("passInput").addEventListener("keypress", function(e) { if (e.key === "Enter") bootSystem(); });

        // --- 2. LOCAL FILE & HIGH PRECISION BASS ---
        document.getElementById("file-upload").addEventListener("change", function(e) {
            var file = e.target.files[0];
            if (!file) return;

            if(player) player.pauseVideo();
            stopBassSimulation(); 
            
            isLocalFile = true;
            var fileURL = URL.createObjectURL(file);
            audioEl.src = fileURL;
            audioEl.play();
            
            document.getElementById("track-title").innerText = "LOCAL FILE: " + file.name;
            document.getElementById("track-title").style.color = "#5865F2";
            
            analyzeAudio();
        });

        function initAudioContext() {
            if(!audioCtx) {
                var AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
                analyser = audioCtx.createAnalyser();
                
                // *** UPGRADE 1: HIGHER RESOLUTION ***
                // 2048 allows us to slice the audio frequencies into much smaller chunks
                analyser.fftSize = 2048; 
                
                source = audioCtx.createMediaElementSource(audioEl);
                source.connect(analyser);
                analyser.connect(audioCtx.destination);
            } else if(audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function analyzeAudio() {
            if(!isLocalFile || audioEl.paused) return;

            var bufferLength = analyser.frequencyBinCount;
            var dataArray = new Uint8Array(bufferLength);
            
            function renderFrame() {
                if(!isLocalFile || audioEl.paused) return;
                requestAnimationFrame(renderFrame);
                
                analyser.getByteFrequencyData(dataArray);

                // *** UPGRADE 2: STRICT FREQUENCY TARGETING ***
                // Each "bin" is roughly 21Hz wide (44100 / 2048).
                // Bin 0 is DC offset/rumble.
                // Bin 1-6 = roughly 20Hz to 130Hz (Pure Bass/Kick)
                // We ignore everything above Bin 6 (Vocals, guitars, snares)
                
                var bassSum = 0;
                var startBin = 1; // Skip ultra-low rumble
                var endBin = 6;   // Stop before Low-Mids
                
                for(var i = startBin; i < endBin; i++) {
                    bassSum += dataArray[i];
                }
                
                var bassAverage = bassSum / (endBin - startBin);

                // *** UPGRADE 3: DYNAMIC THRESHOLD ***
                var interface = document.getElementById("main-interface");
                
                // Threshold must be high (230 out of 255) to only catch the PEAKS
                if(bassAverage > 230) { 
                    interface.classList.add("bass-active");
                } else {
                    interface.classList.remove("bass-active");
                }
            }
            renderFrame();
        }

        // --- 3. YOUTUBE SIMULATION ---
        function startBassSimulation() {
            if(bassInterval) clearInterval(bassInterval);
            bassInterval = setInterval(function() {
                var interface = document.getElementById("main-interface");
                interface.classList.add("bass-active");
                setTimeout(function() { interface.classList.remove("bass-active"); }, 100);
            }, 500); 
        }
        function stopBassSimulation() {
            if(bassInterval) clearInterval(bassInterval);
            document.getElementById("main-interface").classList.remove("bass-active");
        }

        // --- 4. YOUTUBE PLAYER ---
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%', width: '100%',
                playerVars: { 
                    listType: 'playlist', 
                    list: 'PLjfvigiRyKiQssXQlwq1Miytkk6wJV3aX', 
                    index: 0, 
                    autoplay: 1, mute: 1, loop: 1, modestbranding: 1, rel: 0, 
                    origin: window.location.origin 
                },
                events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange, 'onError': onPlayerError }
            });
        }
        function onPlayerReady(event) {
            document.getElementById("track-title").innerText = "SYSTEM READY. AWAITING BOOT.";
            document.getElementById("track-title").style.color = "#00ff00";
        }
        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isLocalFile = false; audioEl.pause(); 
                var data = player.getVideoData();
                document.getElementById("track-title").innerText = data.title;
                document.getElementById("track-title").style.color = "#fff";
                startBassSimulation();
            } else if (event.data === YT.PlayerState.PAUSED) {
                if(!isLocalFile) stopBassSimulation();
            }
        }
        function onPlayerError(event) { console.log("YT Error:", event.data); stopBassSimulation(); }

        // --- 5. CONTROLS ---
        function switchTab(tabName) {
            document.getElementById("tab-btn-comms").classList.remove("active");
            document.getElementById("tab-btn-media").classList.remove("active");
            document.getElementById("view-comms").classList.remove("active");
            document.getElementById("view-media").classList.remove("active");
            document.getElementById("tab-btn-" + tabName).classList.add("active");
            document.getElementById("view-" + tabName).classList.add("active");
        }

        function togglePlay() { 
            if(isLocalFile) {
                if(audioEl.paused) { audioEl.play(); analyzeAudio(); document.getElementById("track-title").innerText = "Resuming Local File..."; } 
                else { audioEl.pause(); document.getElementById("track-title").innerText = "Paused"; }
            } else {
                if(player) { var state = player.getPlayerState(); (state === 1) ? player.pauseVideo() : player.playVideo(); } 
            }
        }
        function nextTrack() { if(!isLocalFile && player) player.nextVideo(); }
        function prevTrack() { if(isLocalFile) audioEl.currentTime = 0; else if(player) player.previousVideo(); }

    </script>
</body>
</html>
